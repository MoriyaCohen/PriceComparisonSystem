<!-- src/app/components/barcode-search.component.html -->

<div class="barcode-search-container">
  <!-- ×›×•×ª×¨×ª ×”×“×£ -->
  <div class="page-header">
    <h1 class="page-title">×—×™×¤×•×© ××•×¦×¨ ×œ×¤×™ ×‘×¨×§×•×“</h1>
    <p class="page-subtitle">×”×–×Ÿ ××¡×¤×¨ ×‘×¨×§×•×“ ×œ×§×‘×œ×ª ×”×©×•×•××ª ××—×™×¨×™× ×‘×™×Ÿ ×¨×©×ª×•×ª ×”×©×™×•×•×§</p>
  </div>

  <!-- ×˜×•×¤×¡ ×§×œ×™×˜×ª ×‘×¨×§×•×“ -->
  <div class="search-form-container">
    <form [formGroup]="barcodeForm" (ngSubmit)="onSubmit()" class="barcode-form">
      
      <!-- ×©×“×” ×§×œ×™×˜×ª ×‘×¨×§×•×“ -->
      <div class="form-group">
        <label for="barcode" class="form-label">
          ××¡×¤×¨ ×‘×¨×§×•×“
          <span class="required-asterisk">*</span>
        </label>
        
        <div class="input-container">
          <!-- ×©×“×” ×”×§×œ×˜ -->
          <input
            type="text"
            id="barcode"
            formControlName="barcode"
            class="form-input"
            [class.input-error]="shouldShowFieldError('barcode')"
            [class.input-valid]="validationStatus === BarcodeValidationStatus.VALID"
            [class.input-validating]="validationStatus === BarcodeValidationStatus.VALIDATING"
            placeholder="×”×–×Ÿ ××¡×¤×¨ ×‘×¨×§×•×“ (8-13 ×¡×¤×¨×•×ª)"
            autocomplete="off"
            [disabled]="isLoading"
            maxlength="13"
            inputmode="numeric"
            pattern="[0-9]*"
          />
          
          <!-- ××™×™×§×•×Ÿ ×¡×˜×˜×•×¡ -->
          <div class="input-status-icon">
            <!-- ××™×™×§×•×Ÿ ×ª×§×™×Ÿ -->
            <svg 
              *ngIf="validationStatus === BarcodeValidationStatus.VALID && !isLoading"
              class="icon icon-success" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            
            <!-- ××™×™×§×•×Ÿ ×©×’×™××” -->
            <svg 
              *ngIf="validationStatus === BarcodeValidationStatus.INVALID"
              class="icon icon-error" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            
            <!-- ××™×™×§×•×Ÿ ×˜×¢×™× ×” -->
            <div 
              *ngIf="isLoading"
              class="loading-spinner"
            ></div>
          </div>
        </div>

        <!-- ×”×•×“×¢×•×ª ×©×’×™××” ×©×œ ×”×©×“×” -->
        <div 
          *ngIf="shouldShowFieldError('barcode')" 
          class="field-error-message"
        >
          {{ getFieldErrorMessage('barcode') }}
        </div>

        <!-- ×”× ×—×™×•×ª ×œ××©×ª××© -->
        <div class="field-help-text">
          ×‘×¨×§×•×“ ×ª×§×™×Ÿ ××›×™×œ 8, 12 ××• 13 ×¡×¤×¨×•×ª. × ×™×ª×Ÿ ×œ××¦×•× ××•×ª×• ×¢×œ ×’×‘×™ ××¨×™×–×ª ×”××•×¦×¨.
        </div>
      </div>

      <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” -->
      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isLoading || barcodeForm.invalid"
          [class.btn-loading]="isLoading"
        >
          <span *ngIf="!isLoading">×—×¤×© ××•×¦×¨</span>
          <span *ngIf="isLoading">××—×¤×©...</span>
        </button>

        <button
          type="button"
          class="btn btn-secondary"
          (click)="resetForm()"
          [disabled]="isLoading"
        >
          ××™×¤×•×¡
        </button>
      </div>

      <!-- ×”×•×“×¢×ª ×©×’×™××” ×›×œ×œ×™×ª -->
      <div 
        *ngIf="currentErrorMessage" 
        class="error-message"
      >
        <svg class="icon icon-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        {{ currentErrorMessage }}
      </div>
    </form>
  </div>

  <!-- ×ª×•×¦××•×ª ×”×—×™×¤×•×© -->
  <div class="search-results-container" *ngIf="searchResults$ | async as results">
    
    <!-- ××¦×‘ ×˜×¢×™× ×” -->
    <div *ngIf="(searchStatus$ | async) === SearchStatus.SEARCHING" class="loading-state">
      <div class="loading-spinner large"></div>
      <p class="loading-text">××—×¤×© ××•×¦×¨ ×•××©×•×•×” ××—×™×¨×™×...</p>
    </div>

    <!-- ××•×¦×¨ ×œ× × ××¦× -->
    <div *ngIf="(searchStatus$ | async) === SearchStatus.NOT_FOUND" class="not-found-state">
      <svg class="icon icon-not-found" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.467-.846-6.127-2.239"></path>
      </svg>
      <h3>××•×¦×¨ ×œ× × ××¦×</h3>
      <p>×”××•×¦×¨ ×¢× ×”×‘×¨×§×•×“ ×©×”×•×–×Ÿ ×œ× × ××¦× ×‘××¢×¨×›×ª ×©×œ× ×•.</p>
      <p class="help-text">× ×¡×” ×œ×‘×“×•×§ ×©×”×‘×¨×§×•×“ ×”×•×–×Ÿ × ×›×•×Ÿ ××• ×—×¤×© ××•×¦×¨ ××—×¨.</p>
    </div>

    <!-- ×©×’×™××” ×‘×—×™×¤×•×© -->
    <div *ngIf="(searchStatus$ | async) === SearchStatus.ERROR && results.errorMessage" class="error-state">
      <svg class="icon icon-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3>×©×’×™××” ×‘×—×™×¤×•×©</h3>
      <p>{{ results.errorMessage }}</p>
    </div>

    <!-- ×ª×•×¦××•×ª ××•×¦×œ×—×•×ª -->
    <div *ngIf="(searchStatus$ | async) === SearchStatus.SUCCESS && results.success" class="success-results">
      
      <!-- ×¤×¨×˜×™ ×”××•×¦×¨ -->
      <div class="product-info" *ngIf="results.productInfo">
        <h2 class="product-name">{{ results.productInfo.productName }}</h2>
        <div class="product-details">
          <span class="product-barcode">×‘×¨×§×•×“: {{ results.productInfo.barcode }}</span>
          <span *ngIf="results.productInfo.manufacturerName" class="product-manufacturer">
            ×™×¦×¨×Ÿ: {{ results.productInfo.manufacturerName }}
          </span>
        </div>
      </div>

      <!-- ×”××—×™×¨ ×”×–×•×œ ×‘×™×•×ª×¨ - ××•×“×’×© -->
      <div class="cheapest-result" *ngIf="getCheapestPrice()">
        <h3 class="cheapest-title">ğŸ’° ×”××—×™×¨ ×”×–×•×œ ×‘×™×•×ª×¨</h3>
        <div class="price-card primary">
          <div class="price-main">â‚ª{{ getCheapestPrice()?.currentPrice | number:'1.2-2' }}</div>
          <div class="store-details">
            <div class="chain-name">{{ getCheapestPrice()?.chainName }}</div>
            <div class="sub-chain" *ngIf="getCheapestPrice()?.subChainName">({{ getCheapestPrice()?.subChainName }})</div>
            <div class="store-name">{{ getCheapestPrice()?.storeName }}</div>
            <div class="store-address" *ngIf="getCheapestPrice()?.storeAddress">{{ getCheapestPrice()?.storeAddress }}</div>
          </div>
        </div>
      </div>

      <!-- ×ª×•×¦××•×ª × ×•×¡×¤×•×ª -->
      <div class="additional-results" *ngIf="getAdditionalResults().length > 0">
        <h4 class="additional-title">ğŸ“‹ ×ª×•×¦××•×ª × ×•×¡×¤×•×ª</h4>
        <div class="price-list">
          <div *ngFor="let price of getAdditionalResults(); trackBy: trackByPrice" class="price-row">
            <div class="price-amount">â‚ª{{ price.currentPrice | number:'1.2-2' }}</div>
            <div class="store-info">
              <span class="chain">{{ price.chainName }}</span>
              <span class="sub-chain" *ngIf="price.subChainName">({{ price.subChainName }})</span>
              <span class="separator">â€¢</span>
              <span class="store">{{ price.storeName }}</span>
              <div class="address" *ngIf="price.storeAddress">{{ price.storeAddress }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ××—×™×¨×™× -->
      <div class="price-statistics" *ngIf="results.statistics">
        <h3 class="statistics-title">×¡×™×›×•× ××—×™×¨×™×</h3>
        <div class="statistics-grid">
          <div class="stat-item stat-min">
            <span class="stat-label">×–×•×œ ×‘×™×•×ª×¨</span>
            <span class="stat-value">â‚ª{{ results.statistics.minPrice | number:'1.2-2' }}</span>
          </div>
          <div class="stat-item stat-avg">
            <span class="stat-label">×××•×¦×¢</span>
            <span class="stat-value">â‚ª{{ results.statistics.averagePrice | number:'1.2-2' }}</span>
          </div>
          <div class="stat-item stat-max">
            <span class="stat-label">×™×§×¨ ×‘×™×•×ª×¨</span>
            <span class="stat-value">â‚ª{{ results.statistics.maxPrice | number:'1.2-2' }}</span>
          </div>
        </div>
        <div class="statistics-summary">
          <p>× ××¦× ×‘-{{ results.statistics.storeCount }} ×¡× ×™×¤×™× ×-{{ results.statistics.chainCount }} ×¨×©×ª×•×ª</p>
          <p *ngIf="results.statistics.maxPrice > results.statistics.minPrice" class="savings-info">
            ×—×™×¡×›×•×Ÿ ××¤×©×¨×™ ×©×œ â‚ª{{ (results.statistics.maxPrice - results.statistics.minPrice) | number:'1.2-2' }}
          </p>
        </div>
      </div>
    </div>